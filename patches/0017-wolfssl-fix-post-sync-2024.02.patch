From 8e7a708f1b4d731c7bc3aaaef59e86c29ed7a3ba Mon Sep 17 00:00:00 2001
From: The-BB <tun.chen.bo@gmail.com>
Date: Sun, 11 Feb 2024 18:57:42 +0300
Subject: [PATCH 17/39] wolfssl: fix post-sync, 2024.02

Makefile: вторая часть - изменено
первая часть для патча и сам патч - на любителя (можно не нужно)
---
 package/libs/wolfssl/Makefile                    |  6 +++---
 package/libs/wolfssl/patches/600-fix-paths.patch | 10 ++++++++++
 2 files changed, 13 insertions(+), 3 deletions(-)
 create mode 100644 package/libs/wolfssl/patches/600-fix-paths.patch

diff --git a/package/libs/wolfssl/Makefile b/package/libs/wolfssl/Makefile
index b710f625..dc5b5728 100644
--- a/package/libs/wolfssl/Makefile
+++ b/package/libs/wolfssl/Makefile
@@ -9,7 +9,7 @@ include $(TOPDIR)/rules.mk
 
 PKG_NAME:=wolfssl
 PKG_VERSION:=5.6.6-stable
-PKG_RELEASE:=1
+PKG_RELEASE:=1a
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
 PKG_SOURCE_URL:=https://github.com/wolfSSL/wolfssl/archive/v$(PKG_VERSION)
@@ -100,8 +100,8 @@ This variant uses AES CPU instructions (Intel AESNI or ARMv8 Crypto Extension)
 endef
 
 define Package/libwolfsslcpu-crypto/config
-    if TARGET_armvirt && PACKAGE_libwolfsslcpu-crypto = y
-	comment "You are about to build libwolfsslcpu-crypto into an armvirt_64 image."
+    if TARGET_armsr && PACKAGE_libwolfsslcpu-crypto = y
+	comment "You are about to build libwolfsslcpu-crypto into an armsr_64 image."
 	comment "Ensure all of your installation targets support the Crypto Extension. "
 	comment "Look for the 'aes' feature in /proc/cpuinfo. This library does not do "
 	comment "run-time detection and will crash if the CPU does not support it.     "
diff --git a/package/libs/wolfssl/patches/600-fix-paths.patch b/package/libs/wolfssl/patches/600-fix-paths.patch
new file mode 100644
index 00000000..f4a80d0b
--- /dev/null
+++ b/package/libs/wolfssl/patches/600-fix-paths.patch
@@ -0,0 +1,10 @@
+--- a/src/ssl.c
++++ b/src/ssl.c
+@@ -8523,6 +8523,7 @@ static const char* systemCaDirs[] = {
+ #if defined(__ANDROID__) || defined(ANDROID)
+     "/system/etc/security/cacerts"      /* Android */
+ #else
++    "/opt/etc/ssl/certs",               /* Entware */
+     "/etc/ssl/certs",                   /* Debian, Ubuntu, Gentoo, others */
+     "/etc/pki/ca-trust/source/anchors", /* Fedora, RHEL */
+     "/etc/pki/tls/certs"                /* Older RHEL */
-- 
2.30.2

